{"version":3,"sources":["../../src/operators/capture.js"],"names":["capture","captureIf","modify","captureAndParse","literal","take","params","obj","predicate","undefined","modifier","schema","what","x","skipMessage","toString","options","meta","type","fn","key","parents","parentKeys","result","context","value"],"mappings":"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","file":"capture.js","sourcesContent":["/*       */\nimport { Match, Empty, Skip, Fault } from \"../results\";\nimport { FunctionSchema } from \"../schemas\";\nimport parse from \"../parse\";\nimport { getParams } from \"./utils\";\n\nexport function capture(params) {\n  return captureIf(obj => typeof obj !== \"undefined\", params);\n}\n\nexport function captureIf(predicate, params) {\n  return take(predicate, undefined, params);\n}\n\nexport function modify(predicate, modifier, params) {\n  return take(predicate, undefined, params, { modifier });\n}\n\nexport function captureAndParse(schema, params) {\n  return take(obj => typeof obj !== \"undefined\", schema, params);\n}\n\nexport function literal(what, params) {\n  return take(x => x === what, undefined, params, {\n    skipMessage: x => `Expected value to be ${what.toString()} but got ${x.toString()}.`\n  });\n}\n\nexport function take(predicate, schema, params = {}, options = {}) {\n  const meta = { type: \"take\", schema, params, predicate, options };\n\n  function fn(obj, key, parents, parentKeys) {\n    return context =>\n      predicate(obj)\n        ? typeof schema !== \"undefined\"\n            ? (() => {\n                const result = parse(schema)(obj, key, parents, parentKeys)(context);\n\n                return result instanceof Match\n                  ? new Match(\n                      {\n                        ...obj,\n                        ...result.value\n                      },\n                      { obj, key, parents, parentKeys },\n                      meta\n                    )\n                  : result instanceof Empty\n                      ? new Match(\n                          {\n                            ...obj\n                          },\n                          { obj, key, parents, parentKeys },\n                          meta\n                        )\n                      : result instanceof Skip\n                          ? new Skip(\n                              \"Capture failed in inner schema.\",\n                              { obj, key, parents, parentKeys },\n                              meta\n                            )\n                          : result; //Fault\n              })()\n            : new Match(\n                options.modifier ? options.modifier(obj) : obj,\n                { obj, key, parents, parentKeys },\n                meta\n              )\n        : new Skip(\n            options.skipMessage\n              ? options.skipMessage(obj)\n              : `Predicate returned false. Predicate was ${predicate.toString()}`,\n            { obj, key, parents, parentKeys },\n            meta\n          );\n  }\n\n  return new FunctionSchema(fn, getParams(params), meta);\n}\n"]}